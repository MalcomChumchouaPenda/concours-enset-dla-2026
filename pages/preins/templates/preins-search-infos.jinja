{% extends 'dashboard/layout.jinja' %}
{% set page_id = 'admin_preins_info_pg' %}
{% from 'preins-macros.jinja' import render_pagination, render_messages %}

{# {% block vendor_css %}
    <link href="{{ url_for('static', filename='vendor/basictable/basictable.min.css')}}" rel="stylesheet" type="text/css" />
    <script src="{{ url_for('static', filename='vendor/basictable/basictable.min.js')}}" type="text/javascript"></script>
{% endblock %} #}

{# {% block custom_css %}
    <link href="{{ url_for('preins.static', filename='css/table.css')}}" rel="stylesheet" type="text/css" />
{% endblock %} #}

{% block page_header %}
  <h1>{{ _('Inscriptions') }}</h1>
  <nav class="pb-3" aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('home.dashboard') }}">{{ _('Accueil') }}</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{ _('Inscriptions') }}</li>
    </ol>
  </nav>
{% endblock %}

{% block page_main %}
<div class="container">
  <section class="section row g-4">
  
    <!-- Actions Globales -->
    <div class="row mt-3 g-3">
      <div class="text-center">
        <button class="btn btn-secondary btn-sm m-1" data-bs-toggle="modal" data-bs-target="#filter-form">Filtrer</button>
        <button class="btn btn-secondary btn-sm m-1" data-bs-toggle="modal" data-bs-target="#search-form">Rechercher</button>
        <a class="btn btn-primary btn-sm m-1" role="button" 
           href="{{ url_for('preins.search_infos', filters=filters, keywords=keywords) }}">
           Actualiser
        </a>
      </div>
    </div><!-- End Actions Globales -->

    <!-- Filter Modal Form -->
    <div class="modal fade" id="filter-form" tabindex="-1" aria-labelledby="filter-form-label" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" novalidate method="POST" action="{{ url_for('preins.search_infos_with_filters') }}">
            
          {{ filter_form.csrf_token }}

          <div class="modal-header">
            <h5 class="modal-title" id="filter-form-label">Filtrer par:</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="row m-1">
              {{ filter_form.departement_academique_id.label(class_="col-form-label col-4")}}
              <div class="col-8">{{ filter_form.departement_academique_id(class_="form-select") }}</div>
            </div>
            <div class="row m-1">
              {{ filter_form.filiere_id.label(class_="col-form-label col-4")}}
              <div class="col-8">{{ filter_form.filiere_id(class_="form-select") }}</div>
            </div>
            <div class="row m-1">
              {{ filter_form.niveau_id.label(class_="col-form-label col-4")}}
              <div class="col-8">{{ filter_form.niveau_id(class_="form-select") }}</div>
            </div>
          </div>

          <div class="modal-footer d-flex justify-content-lg-end justify-content-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button type="submit" class="btn btn-primary">Appliquer</button>
          </div>
        </form>
      </div>
    </div><!-- End Filter Modal Form -->

    <!-- Search Modal Form -->
    <div class="modal fade" id="search-form" tabindex="-1" aria-labelledby="search-form-label" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" novalidate method="POST" action="{{ url_for('preins.search_infos') }}">

          {{ search_form.csrf_token }}

          <div class="modal-header">
            <h5 class="modal-title" id="search-form-label">Criteres de recherche</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="row py-1">
              <div class="col-lg-6 col-10">
                {{ search_form.id.label(class_="form-label")}}
                {{ search_form.id(class_="form-control") }}
              </div>
              <div class="col-lg-6 col-10">
                {{ search_form.name.label(class_="form-label")}}
                {{ search_form.name(class_="form-control") }}
              </div>
            </div>
          </div>

          <div class="modal-footer d-flex justify-content-lg-end justify-content-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button type="submit" class="btn btn-primary">Rechercher</button>
          </div>
        </form>
      </div>
    </div><!-- End Search Modal Form -->

    <!-- Contents wrapper -->
    <div class="col-12">
      <div class="card">
        <div class="card-body">     
        
            <!-- Contents Header -->
            <h5 class="card-title">{{ title }}</h5>
            {{ render_messages() }}
            <!-- End Contents Header-->

            {% if records.items %}
              <!-- Contents Table Large Screen -->
              <div class="d-lg-block d-none">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>No</th>
                        <th>Code</th>
                        <th>Noms</th>
                        <th>Classe</th>
                        <th>Matricule</th>
                        <th>Statut</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for inscription in records.items %}
                      <tr>
                        <td>{{ records.first + loop.index - 1 }}</td>
                        <td>{{ inscription.admission.id }}</td>
                        <td>{{ inscription.nom_complet }}</td>
                        <td>{{ inscription.admission.classe_id }}</td>
                        <td>{{ inscription.admission.matricule}}</td>
                        {% if inscription.modified %}
                          <td class="text-danger fst-italic">modifiee</td>
                          <td class="btn-group d-flex justify-content-end">
                            <a class="btn btn-secondary btn-sm" role="button" href="{{ url_for('preins.search_info', search_id=inscription.id)}}">Details</a>
                            <a class="btn btn-primary btn-sm" role="button" href="{{ url_for('preins.clean_info', search_id=inscription.id)}}">Supprimer</a>
                          </td>
                        {% else %}
                          <td class="text-secondary fst-italic"><span>traitee</span></td>
                          <td class="btn-group d-flex justify-content-end">
                            <a class="btn btn-secondary btn-sm" role="button" href="{{ url_for('preins.search_info', search_id=inscription.id)}}">Details</a>
                            <a class="btn btn-primary btn-sm" role="button" href="{{ url_for('preins.debug_info', search_id=inscription.id)}}">Corriger</a>
                          </td>
                        {% endif %}
                      </tr>
                    {% endfor %}
                    </tbody>
                </table>
              </div><!-- End Contents Table Large Screen -->

              <!-- Contents List Small Screen -->
              <div class="d-lg-none d-block">
                <ul class="list-group list-group-flush">
                {% for inscription in records.items %}
                  <li class="list-group-item d-flex flex-column ps-0">
                    <div class="px-0 py-2 fw-bold">No {{ records.first + loop.index - 1 }} sur  {{ records.total }}</div>
                    <div class="px-0">Code: <span class="ms-1">{{ inscription.admission.id }}</span></div>
                    <div class="px-0 d-flex justify-content-start">Noms: <span class="ms-1 mb-1">{{ inscription.nom_complet }}</span></div>
                    <div class="px-0">Classe: <span class="ms-1">{{ inscription.admission.classe_id }}</span></div>
                    <div class="px-0">Matricule: <span class="ms-1">{{ inscription.admission.matricule }}</span></div>
                    {% if inscription.modified %}
                      <div class="px-0 py-1 text-danger fst-italic">Fiche modifiee</div>
                      <div class="d-flex justify-content-end">
                        <a class="btn btn-secondary btn-sm mx-1" role="button" href="{{ url_for('preins.search_info', search_id=inscription.id)}}">Details</a>
                        <a class="btn btn-primary btn-sm mx-1" role="button" href="{{ url_for('preins.clean_info', search_id=inscription.id)}}">Supprimer</a>
                      </div>
                    {% else %}
                      <div class="px-0 py-1 text-secondary fst-italic">Fiche traitee</div>
                      <div class="d-flex justify-content-end pb-1">
                        <a class="btn btn-secondary btn-sm mx-1" role="button" href="{{ url_for('preins.search_info', search_id=inscription.id)}}">Details</a>
                        <a class="btn btn-primary btn-sm mx-1" role="button" href="{{ url_for('preins.debug_info', search_id=inscription.id)}}">Corriger</a>
                      </div>
                    {% endif %}
                  </li>
                {% endfor %}
                </ul>
              </div><!-- End Contents List Small Screen -->

              <!-- Contents Pagination -->
              {{ render_pagination(records, keywords=keywords, filters=filters)}}

            {% else %}
              <!-- No contents -->
              <div class="text-warning">
                <i class="bi bi-exclamation-triangle ms-2 me-1"></i>
                Aucune inscriptions trouvees
              </div><!-- End No contents -->
            {% endif %}

        </div>
      </div>
    </div><!-- End Contents wrapper-->
  </section>   
</div>
{% endblock %}

{# {% block custom_js %}
<script type="text/javascript">
  const table = new basictable('.table');
</script>
{% endblock %} #}

{% block page_authors%} 
    <a>Malcom Chumchoua Penda </a>
{% endblock %}